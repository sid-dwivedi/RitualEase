<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Select Pandit</title>
</head>
<body>
<h2>Select Pandit for <span th:text="${puja.pujaName}"></span></h2>

<!-- ===== Pandit List ===== -->
<ul>
    <li th:each="pandit : ${pandits}">
        <span th:text="${pandit.userName}"></span> -
        <span th:text="${pandit.expertise}"></span>
        <button th:onclick="'bookPuja(' + ${puja.id} + ',' + ${pandit.id} + ')'">Book</button>
    </li>
</ul>

<script>
    function bookPuja(pujaId, panditId) {
        const locationData = JSON.parse(localStorage.getItem("puja_location"));
        const pujaDate = localStorage.getItem("puja_date");
        const timeslot = localStorage.getItem("puja_timeslot");

        if (!locationData || !pujaDate || !timeslot) {
            alert("âš  Missing details! Please go back and select them.");
            return;
        }

        const url = `/book-puja/${pujaId}/${panditId}?location=${encodeURIComponent(locationData.display_name)}&lat=${locationData.lat}&lon=${locationData.lon}&timeslot=${encodeURIComponent(timeslot)}&pujaDate=${pujaDate}`;
        window.location.href = url;
    }
</script>
</body>
</html>
